<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="cs" xml:lang="cs">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><script type="text/javascript">window.NREUM||(NREUM={}),__nr_require=function(e,t,n){function r(n){if(!t[n]){var o=t[n]={exports:{}};e[n][0].call(o.exports,function(t){var o=e[n][1][t];return r(o||t)},o,o.exports)}return t[n].exports}if("function"==typeof __nr_require)return __nr_require;for(var o=0;o<n.length;o++)r(n[o]);return r}({1:[function(e,t,n){function r(){}function o(e,t,n){return function(){return i(e,[f.now()].concat(u(arguments)),t?null:this,n),t?void 0:this}}var i=e("handle"),a=e(2),u=e(3),c=e("ee").get("tracer"),f=e("loader"),s=NREUM;"undefined"==typeof window.newrelic&&(newrelic=s);var p=["setPageViewName","setCustomAttribute","setErrorHandler","finished","addToTrace","inlineHit","addRelease"],d="api-",l=d+"ixn-";a(p,function(e,t){s[t]=o(d+t,!0,"api")}),s.addPageAction=o(d+"addPageAction",!0),s.setCurrentRouteName=o(d+"routeName",!0),t.exports=newrelic,s.interaction=function(){return(new r).get()};var m=r.prototype={createTracer:function(e,t){var n={},r=this,o="function"==typeof t;return i(l+"tracer",[f.now(),e,n],r),function(){if(c.emit((o?"":"no-")+"fn-start",[f.now(),r,o],n),o)try{return t.apply(this,arguments)}catch(e){throw c.emit("fn-err",[arguments,this,e],n),e}finally{c.emit("fn-end",[f.now()],n)}}}};a("setName,setAttribute,save,ignore,onEnd,getContext,end,get".split(","),function(e,t){m[t]=o(l+t)}),newrelic.noticeError=function(e){"string"==typeof e&&(e=new Error(e)),i("err",[e,f.now()])}},{}],2:[function(e,t,n){function r(e,t){var n=[],r="",i=0;for(r in e)o.call(e,r)&&(n[i]=t(r,e[r]),i+=1);return n}var o=Object.prototype.hasOwnProperty;t.exports=r},{}],3:[function(e,t,n){function r(e,t,n){t||(t=0),"undefined"==typeof n&&(n=e?e.length:0);for(var r=-1,o=n-t||0,i=Array(o<0?0:o);++r<o;)i[r]=e[t+r];return i}t.exports=r},{}],4:[function(e,t,n){t.exports={exists:"undefined"!=typeof window.performance&&window.performance.timing&&"undefined"!=typeof window.performance.timing.navigationStart}},{}],ee:[function(e,t,n){function r(){}function o(e){function t(e){return e&&e instanceof r?e:e?c(e,u,i):i()}function n(n,r,o,i){if(!d.aborted||i){e&&e(n,r,o);for(var a=t(o),u=m(n),c=u.length,f=0;f<c;f++)u[f].apply(a,r);var p=s[y[n]];return p&&p.push([b,n,r,a]),a}}function l(e,t){v[e]=m(e).concat(t)}function m(e){return v[e]||[]}function w(e){return p[e]=p[e]||o(n)}function g(e,t){f(e,function(e,n){t=t||"feature",y[n]=t,t in s||(s[t]=[])})}var v={},y={},b={on:l,emit:n,get:w,listeners:m,context:t,buffer:g,abort:a,aborted:!1};return b}function i(){return new r}function a(){(s.api||s.feature)&&(d.aborted=!0,s=d.backlog={})}var u="nr@context",c=e("gos"),f=e(2),s={},p={},d=t.exports=o();d.backlog=s},{}],gos:[function(e,t,n){function r(e,t,n){if(o.call(e,t))return e[t];var r=n();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!1}),r}catch(i){}return e[t]=r,r}var o=Object.prototype.hasOwnProperty;t.exports=r},{}],handle:[function(e,t,n){function r(e,t,n,r){o.buffer([e],r),o.emit(e,t,n)}var o=e("ee").get("handle");t.exports=r,r.ee=o},{}],id:[function(e,t,n){function r(e){var t=typeof e;return!e||"object"!==t&&"function"!==t?-1:e===window?0:a(e,i,function(){return o++})}var o=1,i="nr@id",a=e("gos");t.exports=r},{}],loader:[function(e,t,n){function r(){if(!x++){var e=h.info=NREUM.info,t=d.getElementsByTagName("script")[0];if(setTimeout(s.abort,3e4),!(e&&e.licenseKey&&e.applicationID&&t))return s.abort();f(y,function(t,n){e[t]||(e[t]=n)}),c("mark",["onload",a()+h.offset],null,"api");var n=d.createElement("script");n.src="https://"+e.agent,t.parentNode.insertBefore(n,t)}}function o(){"complete"===d.readyState&&i()}function i(){c("mark",["domContent",a()+h.offset],null,"api")}function a(){return E.exists&&performance.now?Math.round(performance.now()):(u=Math.max((new Date).getTime(),u))-h.offset}var u=(new Date).getTime(),c=e("handle"),f=e(2),s=e("ee"),p=window,d=p.document,l="addEventListener",m="attachEvent",w=p.XMLHttpRequest,g=w&&w.prototype;NREUM.o={ST:setTimeout,SI:p.setImmediate,CT:clearTimeout,XHR:w,REQ:p.Request,EV:p.Event,PR:p.Promise,MO:p.MutationObserver};var v=""+location,y={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-1071.min.js"},b=w&&g&&g[l]&&!/CriOS/.test(navigator.userAgent),h=t.exports={offset:u,now:a,origin:v,features:{},xhrWrappable:b};e(1),d[l]?(d[l]("DOMContentLoaded",i,!1),p[l]("load",r,!1)):(d[m]("onreadystatechange",o),p[m]("onload",r)),c("mark",["firstbyte",u],null,"api");var x=0,E=e(4)},{}]},{},["loader"]);</script>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Ochrana proti spamu v Drupalu I. - Úvod</title>
    <base href="" />
    <link type="text/css" rel="stylesheet" href="https://www.drupal.cz/misc/print.css" />
      </head>
  <body>
        
    <div id="node-24" class="section-1">
  <h1 class="book-heading">Ochrana proti spamu v Drupalu I. - Úvod</h1>
  <p>Spam již dávno není jen doménou e-mailu, ale také webových serverů, které umožňují uživatelům vkládat jakýkoliv obsah. Spamové záznamy zvláště v komentářích se objevují dnes a denně a není výjimkou server, na kterém najdete tisíce spamů. Spam se nevyhýbá ani serverům, které používají Drupal (hlavně osobní blogy), zkusíme se podívat na to, <strong>jak v Drupalu se spamem bojovat</strong>.</p>
<h2>Pozadí spamu</h2>
<p>Spam ve většině případů na servery vkládají roboti, kteří procházejí všechny stránky a hledají vhodné formuláře, do kterých poté vyplní text do &lt;textarea&gt; a nasimulují stisk <strong>všech</strong> tlačítek. Tím se dostáváme k možnostem ochrany proti spamu:</p>
<ol>
<li><strong>Turingův test</strong> - jednoduchý test, který má určit, zda uživatel je člověk, či počítač. V tomto případě většinou jednoduchý početní test typu <i>"Kolik je 2+2?"</i> (<a href="https://cs.wikipedia.org/wiki/Turing%C5%AFv_test">Wikipedia::Turingův Test</a>)</li>
<li><strong>Captcha</strong> - <i>Completely Automated Public Turing Test to Tell Computers and Humans Apart</i>. Jedna z metod turingova testu, obrázek, na kterém je text, který by neměl být rozpoznán počítačem.</li>
<li><strong>Ochranné tlačítko</strong> - většinou závislé na JavaScriptu a předpokladu, že jím roboti nedisponují. Celkem spolehlivá metoda, avšak zde se jí nebudeme zabývat. Zjednodušeně funguje tak, že přidává do stránky turingův výpočetní test, který vyplňuje JavaScriptem. Pokud uživatel JavaScript nemá, může test vyplnit sám, robot má smůlu. Občas také schované submit tlačítko ve formuláři - robot z 99% odešle všechna tlačítka.</li>
<li><strong>Bayes a dns databáze</strong> - většina z nás zná ze svých e-mailových schránek, Bayes teorém se zabývá pravděpodobností výskytu nějakého slova v textu podle své databáze (<a href="https://en.wikipedia.org/wiki/Bayes'_theorem">Wikipedia::Bayes</a>). DNS databáze zase vyhledává v textu webové adresy a dotazuje se na ně známých blacklistů. Některé testy analyzují chování robota a dle toho vyhodnocují, zda bude příspěvek vložen.</li>
<li>Několik dalších doplňkových technik, které popíšu později.</li>
</ol>
<p>Toto nejsou všechny možnosti, jsou to však ty nejpoužívanější.</p>
<h2>Drupal a jeho možnosti</h2>
<p>Drupal nabízí díky svému modulárnímu systému a API několik možností ochrany proti spamu. V současné době můžete použít <strong>Bayes a DNS </strong> databáze, několik forem <strong>Turingova testu</strong> a <strong>hodnotící</strong> filtr. V příštím díle seriálu se budeme zabývat turingovy testy.</p>
  <div id="node-34" class="section-2">
  <h1 class="book-heading">Ochrana proti spamu v Drupalu II. - Captcha</h1>
  <p>Pokračování seriálu o ochraně proti spamu v Drupalu. V tomto díle se budeme zabývat turingovými testy, konkrétně Captchou.</p>
<h2>Captcha a Turingův test</h2>
<p>Tuto ochranu pro Drupal nabízí modul <a href="https://drupal.org/project/captcha">Captcha</a> společně s modulem <a href="https://drupal.org/node/52349">Textimage</a>. První je dostupný pro Drupal 4.6 i 4.7, druhý myslím pouze pro 4.7. Pro komentářovou Captchu ve 4.6 však potřebujete <a href="https://drupal.org/node/28255">patch pro modul comment</a> (existuje více implementací patche, tento konkrétní jsem nezkoušel, doporučuji všem přechod na 4.7). Naopak nová Captcha již vyžaduje modul Textimage (který se nyní stará o generování obrázků), bez něj umožňuje pouze výpočetní test.</p>
<p>Captcha pro Drupal 4.7 nabízí mnoho možností, do kterých formulářů umístit ochranný test:</p>
<ul>
<li>Přidání komentáře</li>
<li>Login formulář</li>
<li>Login blok</li>
<li>Editace uživatele</li>
<li>Registrace uživatele</li>
<li>Zapomenuté heslo</li>
<li>Kontaktní formulář pro uživatele (modul Contact)</li>
<li>Globální kontaktní formulář</li>
<li>Vytvoření node</li>
<li>Vytvoření tématu fóra</li>
</ul>
<p>Všechny tyto možnosti můžete dále rozlišit pro jednotlivé uživatelské role (anonymní a přihlášený uživatel).</p>
<h3>Instalace</h3>
<p>Stáhněte moduly Captcha a Textimage a rozbalte je do adresáře <tt>modules</tt> ve Vaší instalaci Drupalu (Nebo je rozbalte u sebe a nahrajte na místo přes FTP). Oba moduly by již měly obsahovat soubor s příponou <tt>.install</tt>. Nyní se podívejte na stránku <i>http://www.vas-drupal.com/admin/modules</i> a oba moduly aktivujte.</p>
<p>Oba moduly je potřeba nakonfigurovat. Na stránce <i>http://www.vas-drupal.com/admin/settings/textimage</i> naleznete nastavení modulu Textimage. Ten pro svou správnou funkci <strong>vyžaduje nějaký TrueType font</strong>. O tom Vás informuje v poslední záložce: <tt>Number of fonts found: 1</tt>. Pokud žádný nemáte, máte dvě možnosti:</p>
<ol>
<li>Nasměrovat hodnotu <tt>TrueType Fonts Path</tt> na <i>/usr/share/fonts/truetype</i>, pokud používáte Linux a máte vlastní stroj.</li>
<li>Stáhnout si nějaký TrueType font (.ttf) a umístit ho např. do adresáře <tt>misc</tt> ve Vaší instalaci a hodnotu nasměrovat na <i>misc</i>. Pokud žádný font nemáte, můžete některé <strong>stáhnout odsud ze sekce <a href="../../../ke-stazeni.html">Ke stažení</a> v záložce Fonty</strong>.</li>
</ol>
<p>Po nahrání fontů by měl Textimage najít <strong>alespoň jeden font</strong>. Další nastavení nemusíte řešit, pouze, pokud máte chuť.</p>
<p>Podívejte se na stránku <i>http://www.vas-drupal.com/admin/settings/captcha</i>. Důležitým nastavením je <tt>Type of captcha to use</tt>. Pokud vyberete <i>textimage</i> a máte správně nakonfigurovaný předchozí modul, captcha bude zobrazovat obrázek. Pokud vyberete <i>captcha</i>, zobrazí se jednoduchý výpočetní test typu "Kolik je 7+7?".</p>
<div style="float: left; width: 210px">
<img src="../../../files/images/captcha.jpg" alt="Ukázka Captcha" style="padding-bottom: 16px;" /><br />
<i>Ukázka Captcha obrázku</i>
</div>
<div style="padding-left: 220px;">
<img src="../../../files/images/mathquestion.jpg" alt="Ukázka matematické Captcha" /><br />
<i>Ukázka matematické Captcha</i>
</div>
<p>Dalším nastavením jsou formuláře, ve kterých se má Captcha použít. My chceme chránit pouze komentáře a registraci uživatele, vybereme tedy <i>User Registration Form</i> a <i>Comment Form</i> v roli pro anonymní uživatele (přihlášení uživatelé již pro nás většinou nejsou nebezpeční, protoze museli projít minimálně jedním turingovým testem).</p>
<p>Nakonec se podívejte na adresu <i>http://www.vas-drupal.com/admin/access</i>, kde nastavte pro všechny potřebné role u modulu Textimage hodnotu <i>access textimages</i> (Typicky to budou <b>všechny role</b>, které v systému máte).</p>
<p>Po uložení nastavení byste měli mít oba formuláře chráněny jedním z Captcha testů. Pokud máte český web (což je pravděpodobné), můžete si všechny veřejné hlášení modulu přeložit v nastavení lokalizace.</p>
<p>V příštím díle seriálu se podíváme na Bayesovské databáze a DNS blacklisty.</p>
  </div>
<div id="node-35" class="section-2">
  <h1 class="book-heading">Ochrana proti spamu v Drupalu III. - Bayes a DNS blacklisty</h1>
  <p>Dnešní díl seriálu bude pojednávat o Bayes databázích a DNS blacklistech pro odchytávání spamu v Drupalu.</p>
<h2>Modul Spam</h2>
<p>Modul spam je již druhou verzí sama sebe, jeho autorem je Jeremy Andrews z webu <a href="http://kerneltrap.org">kerneltrap.org</a>. Je dostupný na adrese <a href="http://www.kerneltrap.org/jeremy/drupal/spam/">http://www.kerneltrap.org/jeremy/drupal/spam/</a>, z originální stránky modulu na Drupal.org vede pouze odkaz.</p>
<p>Tento modul si udržuje vlastní Bayes databázi spamů a na její základě spamy hodnotí komentáře a automaticky je schovává v případě spamu. Součástí detekce je i detekce URL v komentáři, které jsou pak porovnávány s online DNS blacklistem <a href="http://surbl.org">SURBL</a>.</p>
<h3>Instalace</h3>
<p>Stáhněte <a href="http://www.kerneltrap.org/jeremy/drupal/spam/#downloads">modul</a> pro Vaši verzi Drupalu a dle vzoru Captcha ho umístěte do adresáře <tt>modules</tt>. Po aktivaci modulu v záložce <i>modules</i> se vrhneme na nastavení.</p>
<p>Modul má k dispozici 2 rozhraní pro své nastavení. První najdete na adrese <i>http://www.vas-drupal.com/admin/spam</i>, druhé na <i>http://www.vas-drupal.com/admin/settings/spam</i>. To první slouží k zobrazení logu modulu a nastavení vlastních filtrů. Máte možnost si definovat filtr na libovolný regulární výraz nebo url a akci, která se provede, pokud nějaký komentář obsahuje daný výraz (zahodit jako spam, nastavit jako ham).</p>
<p>V druhém nastavení doporučuji zvláště hodnoty <tt>Maximum allowed URLs</tt> a <tt>Maximum repeat URLs</tt>. První říká, kolik URL se může objevit v jednom příspěvku, druhá říká, kolik URL se v příspěvku může opakovat. Spamy většinou obsahují mnoho URL a většinou se opakují. Toto nastavení je tak velice užitečné.</p>
<p>V záložce <b>akce</b> zaškrtněte <tt>Unpublish spam</tt> a <tt>Notify user</tt>. Pokud je některý příspěvek vyhodnocen jako spam, bude automaticky schován a uživateli bude na obrazovku vypsáno upozornění. Kdyby totiž došlo k nechtěnému označení příspěvku jako spam i v případě, že se o spam nejedná, bude o tom uživatel alespoň vědět.</p>
<p>Nezapomeňte se podívat na nastavení <i>kontrola přístupu</i> na adrese <i>http://www.vas-drupal.com/admin/access</i>. Zde nastavte potřebné role pro Vaše uživatele, nejdůležitější je možnost <i>report spam</i>, kterou by měli mít přihlášení uživatelé. U každého komentáře se jim poté zobrazí tlačítka, kterým daný příspěvek mohou označit jako spam. Toto je <b>nutné</b> pro počáteční učení Bayes databáze.</p>
<p>V příštím a závěrečném díle seriálu použijeme hodnotící filtry a některé menší vychytávky pro komentáře.</p>
  </div>
<div id="node-36" class="section-2">
  <h1 class="book-heading">Ochrana proti spamu v Drupalu IV. - Filtry a vychávky</h1>
  <p>Poslední díl seriálu o ochraně proti spamu v Drupalu. Dnes si ukážeme jednu malou vychytávku a jeden hodnotící filtr.</p>
<h2>Comment Closer</h2>
<p>Velkým problémem komentářového spamu je čas. Roboti procházejí všechny stránky, často tedy přidají spam i k některým článkům, které již dávno nejsou na úvodní, ani na desáté stránce. Vy si jich nevšímáte a proto si nevšimnete ani spamu. Občas je tedy dobré zakázat přidávání komentářů ke starším článkům. Právě na to slouží modul <a href="https://drupal.org/node/14524">Comment Closer</a>.</p>
<p>Jeho instalace je velice jednoduchá, nebudeme se jí zabývat. Po instalaci naleznete jeho nastavení na <i>http://www.vas-drupal.com/admin/settings/comment_closer</i>. Důležitá nastavení jsou tři, první určuje, u kterých typů obsahu se mají komentáře zakazovat, druhé, jaký je interval pro blokaci (týden, měsíc, čtvrt roku, rok staré) a třetí, jak často se má tento modul spouštět (<b>Pozor:</b> modul vyžaduje funkční Cron ve Vaší instalaci)</p>
<p><img src="../../../files/images/commentclosed_0.jpg" /><br />
<i>Výsledek po zavření článku</i></p>
<h2>Bad Behavior</h2>
<p>Modul <a href="https://drupal.org/node/30501">Bad Behavior</a> je jeden z hodnotících filtrů, které se ale účastní hodnocení již při načtení stránky, ne jen při přidávání komentáře. Na základě známých znaků kontroluje, odkud roboti přicházejí, protože ti často posílají nesmyslný referer, či kontroluje jiné známé znaky ze své databáze. Je to takový mod_security pro Drupal. Já sám ho nepoužívám, jeho instalaci nechám na Vás.</p>
<h2>Závěr</h2>
<p>V tomto seriálu jsme se seznámili se základními možnostmi ochrany proti spamu a ukázali jsme si návod na instalaci několika modulů, které to zajišťují. Pokud budete mít jakékoliv dotazy, můžete se ptát v diskusi pod článkem, případné problémy s instalací modulů směřujte do diskusního fóra.</p>
  </div>
</div>
    
  <script type="text/javascript">window.NREUM||(NREUM={});NREUM.info={"beacon":"bam.nr-data.net","licenseKey":"f34920590d","applicationID":"65778001","transactionName":"bgZbYkBQC0IAVEBaV1dMeFVGWApfTlVbXFNmBkFGXUMR","queueTime":0,"applicationTime":220,"atts":"QkFYFAhKGEw=","errorBeacon":"bam.nr-data.net","agent":""}</script></body>
</html>
